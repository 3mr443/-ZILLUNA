<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø¸ÙÙ„Ù‘Ù†Ø§ | Zilluna Emerald - Ø§Ù„Ø¯Ù‚Ø© Ø§Ù„Ù…Ø·Ù„Ù‚Ø©</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Arabic:wght@100;300;400;700;900&display=swap" rel="stylesheet">
    
    <!-- GIS & Advanced Visualization -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://leaflet.github.io/Leaflet.heat/dist/leaflet-heat.js"></script>
    
    <style>
        :root {
            --emerald-primary: #10b981;
            --emerald-glow: #34d399;
            --deep-space: #010305;
            --ui-border: rgba(16, 185, 129, 0.2);
        }
        
        body { 
            font-family: 'Noto Sans Arabic', sans-serif; 
            background-color: var(--deep-space); 
            color: #f8fafc; 
            overflow: hidden; 
        }

        #map { width: 100%; height: 100vh; background: #000; filter: saturate(1.1) contrast(1.1); }

        .glass-panel {
            background: rgba(1, 3, 5, 0.96);
            backdrop-filter: blur(30px);
            border-left: 1px solid var(--ui-border);
            width: 480px;
            z-index: 2000;
            box-shadow: -10px 0 50px rgba(0,0,0,0.8);
            transition: transform 0.5s cubic-bezier(0.19, 1, 0.22, 1);
        }

        .radar-pulse {
            position: absolute;
            border: 2px solid var(--emerald-primary);
            border-radius: 50%;
            animation: pulse-ring 2.5s cubic-bezier(0.215, 0.61, 0.355, 1) infinite;
            pointer-events: none;
            box-shadow: 0 0 20px var(--emerald-primary);
        }
        @keyframes pulse-ring {
            0% { transform: scale(0.1); opacity: 1; }
            80%, 100% { transform: scale(4.5); opacity: 0; }
        }

        .nav-sidebar {
            width: 80px;
            background: rgba(0, 0, 0, 0.95);
            border-left: 1px solid rgba(255, 255, 255, 0.05);
            display: flex;
            flex-direction: column;
            align-items: center;
            padding-top: 1.5rem;
            z-index: 2500;
        }

        .nav-link {
            margin-bottom: 2rem;
            padding: 1rem;
            border-radius: 1rem;
            cursor: pointer;
            transition: all 0.5s;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.25rem;
            color: #475569;
        }
        .nav-link.active {
            background: rgba(16, 185, 129, 0.1);
            color: #34d399;
            box-shadow: 0 0 20px rgba(16,185,129,0.15);
            border: 1px solid var(--ui-border);
        }

        .stat-card {
            background: linear-gradient(145deg, rgba(16, 185, 129, 0.08) 0%, rgba(0,0,0,0.4) 100%);
            border: 1px solid var(--ui-border);
            padding: 1.25rem;
            border-radius: 1.5rem;
            transition: all 0.3s;
        }

        .custom-scroll::-webkit-scrollbar { width: 3px; }
        .custom-scroll::-webkit-scrollbar-thumb { background: var(--emerald-primary); border-radius: 10px; }

        .hidden-page { display: none !important; }

        .vision-text {
            background: linear-gradient(to left, #10b981, #34d399, #6ee7b7);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            font-weight: 900;
        }

        .neighborhood-boundary {
            stroke-dasharray: 10, 5;
            animation: dash 20s linear infinite;
        }
        @keyframes dash { to { stroke-dashoffset: -1000; } }

        .loading-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border: 2px solid rgba(16, 185, 129, 0.3);
            border-top-color: #10b981;
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }
        @keyframes spin { to { transform: rotate(360deg); } }

        .data-precision-badge {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.375rem 0.75rem;
            background: rgba(16, 185, 129, 0.1);
            border: 1px solid var(--ui-border);
            border-radius: 9999px;
            font-size: 0.625rem;
            font-weight: 700;
            color: #34d399;
        }

        .tree-recommendation-card {
            background: linear-gradient(145deg, rgba(16, 185, 129, 0.05) 0%, rgba(0,0,0,0.3) 100%);
            border: 1px solid var(--ui-border);
            border-left: 3px solid var(--emerald-primary);
            padding: 1rem;
            border-radius: 1rem;
            transition: all 0.3s;
            cursor: default;
        }

        .tree-recommendation-card:hover {
            transform: translateX(-4px);
            border-left-width: 5px;
            box-shadow: 0 0 20px rgba(16, 185, 129, 0.15);
        }

        .zone-type-badge {
            padding: 0.25rem 0.625rem;
            border-radius: 0.5rem;
            font-size: 0.625rem;
            font-weight: 700;
            text-transform: uppercase;
        }

        .zone-residential { background: rgba(59, 130, 246, 0.2); color: #60a5fa; }
        .zone-industrial { background: rgba(239, 68, 68, 0.2); color: #f87171; }
        .zone-commercial { background: rgba(245, 158, 11, 0.2); color: #fbbf24; }
        .zone-park { background: rgba(34, 197, 94, 0.2); color: #4ade80; }

        .metric-mini {
            display: flex;
            align-items: center;
            gap: 0.375rem;
            font-size: 0.625rem;
            color: #94a3b8;
        }

        .metric-mini-icon {
            width: 14px;
            height: 14px;
            opacity: 0.6;
        }
    </style>
</head>
<body class="flex h-screen w-screen overflow-hidden">

    <!-- Navigation Sidebar -->
    <nav class="nav-sidebar">
        <div class="w-12 h-12 bg-emerald-500 rounded-2xl flex items-center justify-center text-black font-black text-2xl shadow-[0_0_30px_rgba(16,185,129,0.4)] mb-12">Ø¸</div>
        
        <div onclick="switchPage('radar')" id="tab-radar" class="nav-link active">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><circle cx="12" cy="12" r="10"/><path d="M12 2v20M2 12h20"/></svg>
            <span style="font-size: 8px; font-weight: 900; text-transform: uppercase; margin-top: 0.25rem;">Ø§Ù„Ø±Ø§Ø¯Ø§Ø±</span>
        </div>

        <div onclick="switchPage('ai')" id="tab-ai" class="nav-link">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/></svg>
            <span style="font-size: 8px; font-weight: 900; text-transform: uppercase; margin-top: 0.25rem;">Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯</span>
        </div>
        
        <div style="margin-top: auto; margin-bottom: 2rem; opacity: 0.2; transition: opacity 0.3s;">
            <div style="font-size: 8px; font-weight: 700; text-align: center; color: white; writing-mode: vertical-rl; transform: rotate(180deg); letter-spacing: 0.15em;">VISION 2030</div>
        </div>
    </nav>

    <!-- Main Logic Panel -->
    <aside class="glass-panel h-full flex flex-col relative overflow-hidden">
        
        <!-- Radar & Precision Analysis -->
        <div id="page-radar" class="flex flex-col h-full">
            <div style="padding: 2rem; border-bottom: 1px solid rgba(255,255,255,0.05);">
                <div class="flex justify-between items-start">
                    <div>
                        <h1 class="text-3xl font-black vision-text">Ø¸ÙÙ„Ù‘Ù†Ø§ | ZILLUNA</h1>
                        <p style="font-size: 10px; color: rgba(52, 211, 153, 0.7); font-weight: 700; letter-spacing: 0.3em; text-transform: uppercase; margin-top: 0.25rem;">Ø§Ù„Ø¯Ù‚Ø© Ø§Ù„Ù…Ø·Ù„Ù‚Ø© â€¢ Absolute Precision</p>
                        
                    </div>
                </div>
            </div>

            <div class="flex-1 overflow-y-auto custom-scroll" style="padding: 2rem;">
                <div style="display: flex; flex-direction: column; gap: 2rem;">
                    <!-- Search Section -->
                    <div style="display: flex; flex-direction: column; gap: 1rem;">
                        <div style="position: relative;">
                            <input type="text" id="locSearch" onkeypress="if(event.key==='Enter') searchNeighborhood()" 
                                   placeholder="Ø§Ø¨Ø­Ø« Ø¹Ù† Ø­ÙŠ Ø£Ùˆ Ø´Ø§Ø±Ø¹ (Ù…Ø«Ø§Ù„: Ø­ÙŠ Ø§Ù„ØµÙØ±Ø§Ø¡ØŒ Ø­ÙŠ Ø§Ù„Ø¬Ø±Ø¯Ø©)..." 
                                   style="width: 100%; background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); padding: 1.25rem; border-radius: 1rem; outline: none; transition: all 0.3s; font-size: 0.875rem; font-weight: 500; color: white;">
                            <span style="position: absolute; left: 1.25rem; top: 1.25rem; color: #10b981; opacity: 0.5;">ğŸ›°ï¸</span>
                        </div>
                        <button onclick="analyzeCurrentView()" style="width: 100%; padding: 1.25rem; border-radius: 1rem; background: #10b981; color: black; font-size: 0.75rem; font-weight: 900; transition: all 0.3s; box-shadow: 0 10px 30px rgba(16,185,129,0.2); border: none; cursor: pointer;">
                            ØªØ­Ù„ÙŠÙ„ Ø¯Ù‚ÙŠÙ‚ Ù„Ù„Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ù…Ø±Ø¦ÙŠØ© ğŸ¯
                        </button>
                    </div>

                    <!-- Live Precision HUD -->
                    <div id="hudContent" class="hidden-page" style="display: flex; flex-direction: column; gap: 1.5rem;">
                        <!-- Main Analysis Card -->
                        <div class="stat-card">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                                <h2 id="areaTitle" style="font-size: 1.25rem; font-weight: 900; color: white;">--</h2>
                                <span id="zoneTypeBadge" class="zone-type-badge">--</span>
                            </div>
                            
                            <!-- Core Metrics Grid -->
                            <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 1rem; margin-bottom: 1rem;">
                                <div style="background: rgba(0,0,0,0.4); padding: 1rem; border-radius: 1rem; border: 1px solid rgba(255,255,255,0.05);">
                                    <span style="font-size: 9px; color: #34d399; font-weight: 700; display: block; margin-bottom: 0.25rem; text-transform: uppercase; letter-spacing: 0.05em;">Ø¯Ø±Ø¬Ø© Ø§Ù„Ø­Ø±Ø§Ø±Ø© (LST)</span>
                                    <div id="tempVal" style="font-size: 2rem; font-weight: 900; color: white;">--</div>
                                    <div style="width: 100%; height: 6px; background: rgba(255,255,255,0.1); margin-top: 0.5rem; border-radius: 9999px; overflow: hidden;">
                                        <div id="tempBar" style="height: 100%; background: linear-gradient(to left, #f97316, #dc2626); transition: all 1s;"></div>
                                    </div>
                                </div>
                                <div style="background: rgba(0,0,0,0.4); padding: 1rem; border-radius: 1rem; border: 1px solid rgba(255,255,255,0.05);">
                                    <span style="font-size: 9px; color: #34d399; font-weight: 700; display: block; margin-bottom: 0.25rem; text-transform: uppercase; letter-spacing: 0.05em;">Ù†Ø³Ø¨Ø© Ø§Ù„ØªØ´Ø¬ÙŠØ± (NDVI)</span>
                                    <div id="ndviVal" style="font-size: 2rem; font-weight: 900; color: white;">--</div>
                                    <div style="width: 100%; height: 6px; background: rgba(255,255,255,0.1); margin-top: 0.5rem; border-radius: 9999px; overflow: hidden;">
                                        <div id="ndviBar" style="height: 100%; background: linear-gradient(to left, #34d399, #059669); transition: all 1s;"></div>
                                    </div>
                                </div>
                            </div>

                            <!-- Additional Metrics -->
                            <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 0.75rem;">
                                <div style="background: rgba(0,0,0,0.3); padding: 0.75rem; border-radius: 0.75rem;">
                                    <div class="metric-mini">
                                        <svg class="metric-mini-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 2v20M2 12h20"/></svg>
                                        <span>ÙƒÙØ§Ø¡Ø© Ø§Ù„ØªØ¸Ù„ÙŠÙ„</span>
                                    </div>
                                    <div id="seiVal" style="font-size: 1.25rem; font-weight: 900; color: white; margin-top: 0.25rem;">--</div>
                                </div>
                                <div style="background: rgba(0,0,0,0.3); padding: 0.75rem; border-radius: 0.75rem;">
                                    <div class="metric-mini">
                                        <svg class="metric-mini-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"/></svg>
                                        <span>Ù†ÙˆØ¹ Ø§Ù„Ù…Ù†Ø·Ù‚Ø©</span>
                                    </div>
                                    <div id="zoneTypeText" style="font-size: 1rem; font-weight: 700; color: white; margin-top: 0.25rem;">--</div>
                                </div>
                            </div>

                            <!-- Priority Alert -->
                            <div id="priorityAlert" style="margin-top: 1rem; padding: 0.75rem; border-radius: 0.75rem; font-size: 0.75rem; font-weight: 700; text-align: center; display: none;">
                                <span id="priorityText"></span>
                            </div>
                        </div>

                        <!-- Tree Recommendations Section -->
                        <div>
                            <h3 style="font-size: 10px; font-weight: 900; color: #34d399; letter-spacing: 0.15em; text-transform: uppercase; display: flex; align-items: center; gap: 0.5rem; margin-bottom: 1rem;">
                                <div style="width: 8px; height: 8px; background: #10b981; border-radius: 50%; animation: pulse 2s infinite;"></div>
                                ØªÙˆØµÙŠØ§Øª Ø§Ù„ØªØ´Ø¬ÙŠØ± Ø§Ù„Ø°ÙƒÙŠ
                            </h3>
                            <div id="treeGrid" style="display: flex; flex-direction: column; gap: 0.75rem;"></div>
                        </div>

                        <!-- Data Source Attribution -->
                        <div style="background: rgba(16, 185, 129, 0.05); border: 1px solid var(--ui-border); padding: 0.75rem; border-radius: 0.75rem; font-size: 0.625rem; color: #94a3b8; text-align: center;">
                            <div style="font-weight: 700; color: #34d399; margin-bottom: 0.25rem;">Ù…ØµØ§Ø¯Ø± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</div>
                            Sentinel-2 MSI (ESA/Copernicus) â€¢ Landsat-8/9 (NASA/USGS) â€¢ OpenStreetMap Nominatim
                        </div>
                    </div>

                    <div id="welcomeState" style="padding: 5rem 0; text-align: center;">
                        <div style="font-size: 4rem; margin-bottom: 1.5rem; opacity: 0.2;">ğŸŒ³</div>
                        <h3 style="font-size: 1.125rem; font-weight: 900; color: rgba(255,255,255,0.8); font-style: italic;">Ø§Ù„Ø£Ø®Ø¶Ø± Ù‡ÙˆÙŠØªÙ†Ø§</h3>
                        <p style="font-size: 11px; color: #64748b; margin-top: 0.5rem; padding: 0 2.5rem; line-height: 1.6;">Ø§Ù†Ù‚Ø± Ø¹Ù„Ù‰ Ø£ÙŠ Ù†Ù‚Ø·Ø© ÙÙŠ Ø§Ù„Ø®Ø±ÙŠØ·Ø© Ø£Ùˆ Ø§Ø¨Ø­Ø« Ø¹Ù† Ø­ÙŠ Ù…Ø­Ø¯Ø¯ Ù„Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ ØªØ­Ù„ÙŠÙ„ Ø¯Ù‚ÙŠÙ‚ Ø´Ø§Ù…Ù„ Ù„Ù†Ø³Ø¨ Ø§Ù„ØªØ´Ø¬ÙŠØ± ÙˆØ§Ù„Ø­Ø±Ø§Ø±Ø© Ø§Ù„Ø³Ø·Ø­ÙŠØ© Ù…Ø¹ ØªÙˆØµÙŠØ§Øª Ø¹Ù„Ù…ÙŠØ© Ù…Ø®ØµØµØ©.</p>
                    </div>
                </div>
            </div>

            <!-- Creator Credit Footer -->
            <div style="padding: 1.5rem; background: rgba(0,0,0,0.5); border-top: 1px solid rgba(255,255,255,0.05); text-align: center;">
                <p style="font-size: 10px; font-weight: 700; color: #9ca3af;">Ø¨ÙˆØ§Ø³Ø·Ø© Ø§Ù„Ù…Ø¨Ø¯Ø¹: <span style="color: white;">Ø¹Ù…Ø± | Omar</span></p>
                <a href="mailto:om.almutairi@outlook.sa" style="font-size: 9px; color: #10b981; text-decoration: none;">om.almutairi@outlook.sa</a>
            </div>
        </div>

        <!-- AI Cognitive Workspace -->
        <div id="page-ai" class="flex flex-col h-full hidden-page">
            <div style="padding: 2rem; border-bottom: 1px solid rgba(255,255,255,0.05);">
                <h1 class="text-3xl font-black vision-text">Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯ <span style="color: white;">Zilluna</span></h1>
                <p style="font-size: 10px; color: rgba(52, 211, 153, 0.7); font-weight: 700; letter-spacing: 0.3em; text-transform: uppercase; margin-top: 0.25rem;">Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ù…ÙƒØ§Ù†ÙŠ Ø§Ù„Ù…ØªÙ‚Ø¯Ù… â€¢ Advanced Spatial IQ</p>
            </div>

            <div id="chatBox" class="flex-1 overflow-y-auto custom-scroll" style="padding: 2rem; display: flex; flex-direction: column; gap: 1.5rem;">
                <div style="background: rgba(16, 185, 129, 0.05); border: 1px solid rgba(16, 185, 129, 0.2); padding: 1.25rem; border-radius: 1.5rem; border-top-right-radius: 0; font-size: 0.75rem; line-height: 1.6; color: #d1fae5;">
                    Ø£Ù‡Ù„Ø§Ù‹ Ø¨Ùƒ ÙŠØ§ Ø¹Ù…Ø±. Ø£Ù†Ø§ Ù…Ø³Ø§Ø¹Ø¯Ùƒ Ø§Ù„Ù…Ø·ÙˆØ± ÙÙŠ Ù…Ù†ØµØ© Ø¸ÙÙ„Ù‘Ù†Ø§. ØªÙ… ØªØ­Ø¯ÙŠØ«ÙŠ Ø¨Ù‚Ø§Ø¹Ø¯Ø© Ù…Ø¹Ø±ÙÙŠØ© Ø´Ø§Ù…Ù„Ø© Ø¹Ù† Ø£Ø­ÙŠØ§Ø¡ Ø¨Ø±ÙŠØ¯Ø© ÙˆØ§Ù„Ù‚ØµÙŠÙ….
                    <br><br>
                    ÙŠÙ…ÙƒÙ†Ù†ÙŠ Ø§Ù„Ø¢Ù† Ù…Ø³Ø§Ø¹Ø¯ØªÙƒ ÙÙŠ:
                    <ul style="margin-top: 0.75rem; display: flex; flex-direction: column; gap: 0.5rem; color: #34d399; font-weight: 700;">
                        <li style="display: flex; align-items: center; gap: 0.5rem;"><span style="width: 4px; height: 4px; background: #10b981; border-radius: 50%;"></span> ØªØ­Ù„ÙŠÙ„ Ù†Ø³Ø¨ Ø§Ù„ØªØ´Ø¬ÙŠØ± Ø§Ù„ÙØ¹Ù„ÙŠØ© ÙÙŠ Ø£ÙŠ Ø­ÙŠ Ø¨Ø¨Ø±ÙŠØ¯Ø©</li>
                        <li style="display: flex; align-items: center; gap: 0.5rem;"><span style="width: 4px; height: 4px; background: #10b981; border-radius: 50%;"></span> ØªÙˆØµÙŠØ§Øª Ø§Ù„Ø£Ø´Ø¬Ø§Ø± Ø§Ù„Ù…Ù†Ø§Ø³Ø¨Ø© Ø­Ø³Ø¨ Ù†ÙˆØ¹ Ø§Ù„Ù…Ù†Ø·Ù‚Ø© (Ø³ÙƒÙ†ÙŠØ©/ØµÙ†Ø§Ø¹ÙŠØ©/ØªØ¬Ø§Ø±ÙŠØ©)</li>
                        <li style="display: flex; align-items: center; gap: 0.5rem;"><span style="width: 4px; height: 4px; background: #10b981; border-radius: 50%;"></span> Ø­Ø³Ø§Ø¨ Ø¯Ø±Ø¬Ø§Øª Ø§Ù„Ø­Ø±Ø§Ø±Ø© Ø§Ù„Ø³Ø·Ø­ÙŠØ© ÙˆØ§Ù„Ø¬Ø²Ø± Ø§Ù„Ø­Ø±Ø§Ø±ÙŠØ© Ø§Ù„Ø­Ø¶Ø±ÙŠØ©</li>
                        <li style="display: flex; align-items: center; gap: 0.5rem;"><span style="width: 4px; height: 4px; background: #10b981; border-radius: 50%;"></span> Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠØ§Øª Ø§Ù„ØªØ´Ø¬ÙŠØ± Ø§Ù„Ù…Ø«Ù„Ù‰ Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø¨ÙŠØ§Ù†Ø§Øª Ø±Ø¤ÙŠØ© 2030</li>
                    </ul>
                    <div style="margin-top: 1rem; padding: 0.75rem; background: rgba(0,0,0,0.3); border-radius: 0.75rem; font-size: 0.625rem; color: #94a3b8;">
                        <strong style="color: #34d399;">Ù…Ø¹Ù„ÙˆÙ…Ø©:</strong> ØªÙ… Ø²Ø±Ø§Ø¹Ø© 14,777 Ø´Ø¬Ø±Ø© ÙÙŠ Ø¨Ø±ÙŠØ¯Ø© Ø¹Ø§Ù… 2024ØŒ Ùˆ 8,240 Ø´Ø¬Ø±Ø© Ø­ØªÙ‰ Ø§Ù„Ø¢Ù† ÙÙŠ 2025 Ø¶Ù…Ù† Ù…Ø¨Ø§Ø¯Ø±Ø© Ø§Ù„Ù‚ØµÙŠÙ… Ø§Ù„Ø®Ø¶Ø±Ø§Ø¡.
                    </div>
                </div>
            </div>

            <div style="padding: 1.5rem; background: rgba(0,0,0,0.4); border-top: 1px solid rgba(255,255,255,0.05);">
                <div style="display: flex; gap: 0.75rem;">
                    <input type="text" id="aiMsgInput" onkeypress="if(event.key==='Enter') executeChat()" 
                           placeholder="Ø§Ø³Ø£Ù„Ù†ÙŠ Ø¹Ù† Ø£ÙŠ Ø­ÙŠ ÙÙŠ Ø¨Ø±ÙŠØ¯Ø© Ø£Ùˆ Ø§Ù„Ù‚ØµÙŠÙ…..." 
                           style="flex: 1; background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); border-radius: 1rem; padding: 1rem; font-size: 0.75rem; outline: none; transition: all 0.3s; color: white;">
                    <button onclick="executeChat()" style="padding: 1rem; background: #10b981; color: black; border-radius: 1rem; transition: all 0.3s; box-shadow: 0 0 20px rgba(16,185,129,0.2); border: none; cursor: pointer;">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><path d="M22 2L11 13M22 2l-7 20-4-9-9-4 20-7z"/></svg>
                    </button>
                </div>
            </div>
        </div>

    </aside>

    <!-- Map Context -->
    <main style="flex: 1; position: relative;">
        <div id="map"></div>
        
        <!-- Live Telemetry Overlay -->
        <div style="position: absolute; top: 2rem; left: 2rem; z-index: 1500; display: flex; flex-direction: column; gap: 0.5rem; pointer-events: none;">
            <div style="background: rgba(0,0,0,0.8); backdrop-filter: blur(30px); padding: 0.75rem; border-radius: 1rem; border: 1px solid rgba(255,255,255,0.05); font-size: 9px; font-family: monospace; color: #34d399; display: flex; align-items: center; gap: 0.75rem;">
                <div style="width: 6px; height: 6px; background: #10b981; border-radius: 50%; animation: pulse 2s infinite;"></div>
                SYSTEM_LIVE: <span id="geoPos" style="color: white;">SCANNING...</span>
            </div>
            <div id="analysisStatus" style="background: rgba(0,0,0,0.8); backdrop-filter: blur(30px); padding: 0.75rem; border-radius: 1rem; border: 1px solid rgba(255,255,255,0.05); font-size: 9px; font-family: monospace; color: #fbbf24; display: none; align-items: center; gap: 0.75rem;">
                <div class="loading-indicator"></div>
                <span>Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø¯Ù‚ÙŠÙ‚...</span>
            </div>
        </div>

        <!-- Vision Branding -->
        <div style="position: absolute; bottom: 2.5rem; left: 2.5rem; z-index: 1500; display: flex; align-items: center; gap: 1rem; background: rgba(0,0,0,0.6); padding: 1rem; border-radius: 1.5rem; backdrop-filter: blur(15px); border: 1px solid rgba(255,255,255,0.05); box-shadow: 0 20px 60px rgba(0,0,0,0.8);">
            <div style="text-align: right;">
                <div style="font-size: 10px; font-weight: 900; color: white;">Ø±Ø¤ÙŠØ© Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ© Ø§Ù„Ø®Ø¶Ø±Ø§Ø¡</div>
                <div style="font-size: 8px; font-weight: 700; color: #10b981; text-transform: uppercase; letter-spacing: 0.15em;">Absolute Precision â€¢ Data-Driven</div>
            </div>
            <div style="width: 40px; height: 40px; background: #10b981; border-radius: 0.75rem; display: flex; align-items: center; justify-content: center; font-weight: 900; color: black; font-size: 0.75rem;">2030</div>
        </div>
    </main>

    <script>
        let map, heatLayer, activeMarker, boundaryLayer;
        let currentAnalysisData = null;

        // Ù‚Ø§Ø¹Ø¯Ø© Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£Ø´Ø¬Ø§Ø± Ø§Ù„Ù…Ø­Ø¯Ø«Ø© Ø­Ø³Ø¨ Ù†ÙˆØ¹ Ø§Ù„Ù…Ù†Ø·Ù‚Ø© (Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ø¨Ø­Ø« Ø§Ù„Ø¹Ù„Ù…ÙŠ)
        const TREE_DATABASE = {
            residential: {
                high_priority: [
                    { 
                        name: "Ø§Ù„Ø³Ø¯Ø± Ø§Ù„Ø¨Ù„Ø¯ÙŠ (Ziziphus spina-christi)", 
                        scientific: "Ziziphus",
                        waterReq: "Ù…Ù†Ø®ÙØ¶ Ø¬Ø¯Ø§Ù‹ (15-20 Ù„ØªØ±/Ø£Ø³Ø¨ÙˆØ¹)",
                        shade: "Ø¹Ø§Ù„ÙŠ (12-15Ù… Ø¹Ø±Ø¶)",
                        benefit: "Ù…Ø«Ø§Ù„ÙŠ Ù„Ù„Ø³Ø§Ø­Ø§Øª Ø§Ù„Ø³ÙƒÙ†ÙŠØ©ØŒ Ù…Ù‚Ø§ÙˆÙ… Ù„Ù„Ø­Ø±Ø§Ø±Ø© Ø­ØªÙ‰ 50Â°Ù…ØŒ Ø¬Ø°ÙˆØ± Ø¹Ù…ÙŠÙ‚Ø© ØªØµÙ„ Ù„Ù€ 30 Ù…ØªØ±Ø§Ù‹",
                        icon: "ğŸŒ³"
                    },
                    { 
                        name: "Ø§Ù„ØºØ§Ù Ø§Ù„Ø®Ù„ÙŠØ¬ÙŠ (Prosopis cineraria)", 
                        scientific: "Ghaf",
                        waterReq: "Ù…Ù†Ø®ÙØ¶ (10-15 Ù„ØªØ±/Ø£Ø³Ø¨ÙˆØ¹)",
                        shade: "Ù…ØªÙˆØ³Ø·-Ø¹Ø§Ù„ÙŠ (8-12Ù…)",
                        benefit: "ÙŠØ­Ø³Ù† Ø¬ÙˆØ¯Ø© Ø§Ù„ØªØ±Ø¨Ø©ØŒ Ù…Ù‚Ø§ÙˆÙ… Ù„Ù„Ù…Ù„ÙˆØ­Ø©ØŒ Ù…Ù†Ø§Ø³Ø¨ Ù„Ù„Ø­Ø¯Ø§Ø¦Ù‚ Ø§Ù„Ù…Ù†Ø²Ù„ÙŠØ©",
                        icon: "ğŸŒ²"
                    },
                    { 
                        name: "Ø§Ù„Ù†Ø®ÙŠÙ„ (Phoenix dactylifera)", 
                        scientific: "Date Palm",
                        waterReq: "Ù…ØªÙˆØ³Ø· (25-30 Ù„ØªØ±/Ø£Ø³Ø¨ÙˆØ¹)",
                        shade: "Ù…ØªÙˆØ³Ø· (4-6Ù…)",
                        benefit: "Ø±Ù…Ø² ØªØ±Ø§Ø«ÙŠØŒ ØªØ­Ù…Ù„ Ø¹Ø§Ù„ÙŠ Ù„Ù„Ø­Ø±Ø§Ø±Ø©ØŒ Ø¥Ù†ØªØ§Ø¬ Ø§Ù„ØªÙ…ÙˆØ±",
                        icon: "ğŸŒ´"
                    }
                ],
                standard: [
                    { 
                        name: "Ø§Ù„Ù„Ø¨Ø® Ø§Ù„Ù‡Ù†Ø¯ÙŠ (Albizia lebbeck)", 
                        scientific: "Albizia",
                        waterReq: "Ù…ØªÙˆØ³Ø· (20-25 Ù„ØªØ±/Ø£Ø³Ø¨ÙˆØ¹)",
                        shade: "Ø¹Ø§Ù„ÙŠ Ø¬Ø¯Ø§Ù‹ (15-18Ù…)",
                        benefit: "Ù†Ù…Ùˆ Ø³Ø±ÙŠØ¹ØŒ ØªØ¸Ù„ÙŠÙ„ Ù…Ù…ØªØ§Ø² Ù„Ù„Ù…Ù…Ø±Ø§Øª ÙˆØ§Ù„Ù…ÙˆØ§Ù‚ÙØŒ Ø²Ù‡ÙˆØ± Ø¹Ø·Ø±ÙŠØ©",
                        icon: "ğŸŒ³"
                    },
                    { 
                        name: "Ø§Ù„Ø³Ù…Ø± Ø§Ù„Ø¹Ø±Ø¨ÙŠ (Acacia tortilis)", 
                        scientific: "Acacia",
                        waterReq: "Ù…Ù†Ø®ÙØ¶ (12-18 Ù„ØªØ±/Ø£Ø³Ø¨ÙˆØ¹)",
                        shade: "Ù…ØªÙˆØ³Ø· (8-10Ù…)",
                        benefit: "Ø³Ø±ÙŠØ¹ Ø§Ù„Ù†Ù…ÙˆØŒ Ù…Ù‚Ø§ÙˆÙ… Ù„Ù„Ø¬ÙØ§ÙØŒ ÙŠØ¬Ø°Ø¨ Ø§Ù„Ø·ÙŠÙˆØ±",
                        icon: "ğŸŒ¿"
                    }
                ]
            },
            industrial: {
                high_priority: [
                    { 
                        name: "Ø§Ù„ÙƒØ§Ø²ÙˆØ§Ø±ÙŠÙ†Ø§ (Casuarina equisetifolia)", 
                        scientific: "Casuarina",
                        waterReq: "Ù…Ù†Ø®ÙØ¶ (15-20 Ù„ØªØ±/Ø£Ø³Ø¨ÙˆØ¹)",
                        shade: "Ù…ØªÙˆØ³Ø· (6-8Ù…)",
                        benefit: "ØªØ­Ù…Ù„ Ø¹Ø§Ù„ÙŠ Ù„Ù„Ù…Ù„ÙˆØ«Ø§Øª (APTI: 6.72)ØŒ Ù…Ù‚Ø§ÙˆÙ… Ù„Ù„Ø±ÙŠØ§Ø­ØŒ Ù…ØµØ¯Ø§Øª Ø±ÙŠØ§Ø­ Ù…Ù…ØªØ§Ø²Ø©",
                        icon: "ğŸŒ²"
                    },
                    { 
                        name: "Ø§Ù„ÙƒØ§ÙÙˆØ± (Eucalyptus camaldulensis)", 
                        scientific: "Eucalyptus",
                        waterReq: "Ù…ØªÙˆØ³Ø·-Ø¹Ø§Ù„ÙŠ (30-35 Ù„ØªØ±/Ø£Ø³Ø¨ÙˆØ¹)",
                        shade: "Ø¹Ø§Ù„ÙŠ (10-14Ù…)",
                        benefit: "ØªØ­Ù…Ù„ Ø¹Ø§Ù„ÙŠ Ù„Ù„Ù…Ù„ÙˆØ«Ø§Øª (APTI: 7.49)ØŒ Ø§Ù…ØªØµØ§Øµ Ù…Ù…ØªØ§Ø² Ù„Ù„ÙƒØ±Ø¨ÙˆÙ†ØŒ Ù†Ù…Ùˆ Ø³Ø±ÙŠØ¹",
                        icon: "ğŸŒ³"
                    },
                    { 
                        name: "Ø§Ù„ØªÙŠÙ† Ø§Ù„Ù…Ø·Ø§Ø·ÙŠ (Ficus altissima)", 
                        scientific: "Ficus",
                        waterReq: "Ù…ØªÙˆØ³Ø· (22-28 Ù„ØªØ±/Ø£Ø³Ø¨ÙˆØ¹)",
                        shade: "Ø¹Ø§Ù„ÙŠ Ø¬Ø¯Ø§Ù‹ (12-16Ù…)",
                        benefit: "Ø§Ù„Ø£Ø¹Ù„Ù‰ ØªØ­Ù…Ù„Ø§Ù‹ Ù„Ù„ØªÙ„ÙˆØ« (APTI: 8.80)ØŒ ØªÙ†Ù‚ÙŠØ© Ù‡ÙˆØ§Ø¡ Ù…Ù…ØªØ§Ø²Ø©ØŒ ÙƒØ«Ø§ÙØ© Ø¸Ù„ Ø¹Ø§Ù„ÙŠØ©",
                        icon: "ğŸŒ´"
                    }
                ],
                standard: [
                    { 
                        name: "Ø§Ù„Ø¨ÙˆÙ†Ø³ÙŠØ§Ù†Ø§ Ø§Ù„ØµÙØ±Ø§Ø¡ (Peltophorum pterocarpum)", 
                        scientific: "Peltophorum",
                        waterReq: "Ù…ØªÙˆØ³Ø· (20-25 Ù„ØªØ±/Ø£Ø³Ø¨ÙˆØ¹)",
                        shade: "Ø¹Ø§Ù„ÙŠ (10-12Ù…)",
                        benefit: "ØªØ­Ù…Ù„ Ù…Ø¹ØªØ¯Ù„ Ù„Ù„Ù…Ù„ÙˆØ«Ø§ØªØŒ Ø£Ø²Ù‡Ø§Ø± Ø¬Ù…ÙŠÙ„Ø©ØŒ Ù…Ù†Ø§Ø³Ø¨ Ù„Ù„Ø´ÙˆØ§Ø±Ø¹ Ø§Ù„ØµÙ†Ø§Ø¹ÙŠØ©",
                        icon: "ğŸŒ³"
                    }
                ]
            },
            commercial: {
                high_priority: [
                    { 
                        name: "Ø§Ù„Ù†ÙŠÙ… (Azadirachta indica)", 
                        scientific: "Neem",
                        waterReq: "Ù…Ù†Ø®ÙØ¶ (18-22 Ù„ØªØ±/Ø£Ø³Ø¨ÙˆØ¹)",
                        shade: "Ø¹Ø§Ù„ÙŠ (10-14Ù…)",
                        benefit: "Ù…Ù†Ù‚ÙŠ Ø·Ø¨ÙŠØ¹ÙŠ Ù„Ù„Ù‡ÙˆØ§Ø¡ØŒ Ù…Ø¶Ø§Ø¯ Ù„Ù„Ø­Ø´Ø±Ø§ØªØŒ Ù…Ù‚Ø§ÙˆÙ… Ù„Ù„ØªÙ„ÙˆØ«ØŒ Ù…Ø«Ø§Ù„ÙŠ Ù„Ù„Ù…Ù†Ø§Ø·Ù‚ Ø§Ù„ØªØ¬Ø§Ø±ÙŠØ©",
                        icon: "ğŸŒ³"
                    },
                    { 
                        name: "Ø§Ù„Ø¨ÙˆÙ†Ø³ÙŠØ§Ù†Ø§ Ø§Ù„Ù…Ù„ÙƒÙŠØ© (Delonix regia)", 
                        scientific: "Delonix",
                        waterReq: "Ù…ØªÙˆØ³Ø· (25-30 Ù„ØªØ±/Ø£Ø³Ø¨ÙˆØ¹)",
                        shade: "Ø¹Ø§Ù„ÙŠ Ø¬Ø¯Ø§Ù‹ (15-20Ù…)",
                        benefit: "Ù…Ø¸Ù‡Ø± Ø¬Ù…Ø§Ù„ÙŠ Ø§Ø³ØªØ«Ù†Ø§Ø¦ÙŠØŒ ØªØ¸Ù„ÙŠÙ„ ÙˆØ§Ø³Ø¹ØŒ Ø¬Ø§Ø°Ø¨ Ù„Ù„Ø¹Ù…Ù„Ø§Ø¡",
                        icon: "ğŸŒº"
                    },
                    { 
                        name: "Ø§Ù„Ø²ÙŠØªÙˆÙ† (Olea europaea)", 
                        scientific: "Olive",
                        waterReq: "Ù…Ù†Ø®ÙØ¶ Ø¬Ø¯Ø§Ù‹ (10-15 Ù„ØªØ±/Ø£Ø³Ø¨ÙˆØ¹)",
                        shade: "Ù…ØªÙˆØ³Ø· (6-8Ù…)",
                        benefit: "Ù…Ù‚Ø§ÙˆÙ… Ù„Ù„Ø¬ÙØ§Ù ÙˆØ§Ù„Ù…Ù„ÙˆØ­Ø©ØŒ Ù‚ÙŠÙ…Ø© Ø¬Ù…Ø§Ù„ÙŠØ© ÙˆØ§Ù‚ØªØµØ§Ø¯ÙŠØ©ØŒ Ø¹Ù…Ø± Ø·ÙˆÙŠÙ„",
                        icon: "ğŸ«’"
                    }
                ],
                standard: [
                    { 
                        name: "Ø§Ù„ØªÙƒÙˆÙ…Ø§ (Tecoma stans)", 
                        scientific: "Tecoma",
                        waterReq: "Ù…Ù†Ø®ÙØ¶ (12-18 Ù„ØªØ±/Ø£Ø³Ø¨ÙˆØ¹)",
                        shade: "Ù…Ù†Ø®ÙØ¶-Ù…ØªÙˆØ³Ø· (4-6Ù…)",
                        benefit: "Ø§Ø²Ù‡Ø§Ø± Ø¯Ø§Ø¦Ù…Ø©ØŒ ØµÙ„Ø¨ØŒ Ù…Ù‚Ø§ÙˆÙ… Ù„Ù„Ø­Ø±Ø§Ø±Ø©ØŒ Ù…Ù†Ø§Ø³Ø¨ Ù„Ù„Ø£Ø±ØµÙØ©",
                        icon: "ğŸŒ¼"
                    },
                    { 
                        name: "Ø§Ù„Ø¯ÙÙ„Ø© (Nerium oleander)", 
                        scientific: "Oleander",
                        waterReq: "Ù…Ù†Ø®ÙØ¶ (15-20 Ù„ØªØ±/Ø£Ø³Ø¨ÙˆØ¹)",
                        shade: "Ù…Ù†Ø®ÙØ¶ (3-5Ù…)",
                        benefit: "ØªØ­Ù…Ù„ Ø¹Ø§Ù„ÙŠ Ù„Ù„Ø­Ø±Ø§Ø±Ø©ØŒ Ø£Ø²Ù‡Ø§Ø± Ù…Ù„ÙˆÙ†Ø©ØŒ Ù…Ù†Ø§Ø³Ø¨ Ù„Ù„ÙÙˆØ§ØµÙ„",
                        icon: "ğŸŒ¸"
                    }
                ]
            },
            park: {
                high_priority: [
                    { 
                        name: "Ø§Ù„Ø¨ÙˆÙ†Ø³ÙŠØ§Ù†Ø§ Ø§Ù„Ù…Ù„ÙƒÙŠØ© (Delonix regia)", 
                        scientific: "Delonix",
                        waterReq: "Ù…ØªÙˆØ³Ø· (30-35 Ù„ØªØ±/Ø£Ø³Ø¨ÙˆØ¹)",
                        shade: "Ø¹Ø§Ù„ÙŠ Ø¬Ø¯Ø§Ù‹ (18-22Ù…)",
                        benefit: "ØªØ¸Ù„ÙŠÙ„ Ø§Ø³ØªØ«Ù†Ø§Ø¦ÙŠ Ù„Ù„Ø­Ø¯Ø§Ø¦Ù‚ØŒ Ø£Ø²Ù‡Ø§Ø± Ø±Ø§Ø¦Ø¹Ø©ØŒ Ø¬Ø§Ø°Ø¨ Ù„Ù„Ø²ÙˆØ§Ø±",
                        icon: "ğŸŒº"
                    },
                    { 
                        name: "Ø§Ù„Ù„ÙˆØ² Ø§Ù„Ù‡Ù†Ø¯ÙŠ (Terminalia catappa)", 
                        scientific: "Terminalia",
                        waterReq: "Ù…ØªÙˆØ³Ø· (25-30 Ù„ØªØ±/Ø£Ø³Ø¨ÙˆØ¹)",
                        shade: "Ø¹Ø§Ù„ÙŠ (12-15Ù…)",
                        benefit: "Ù…Ø¸Ù„Ø© ÙˆØ§Ø³Ø¹Ø©ØŒ Ø£ÙˆØ±Ø§Ù‚ ÙƒØ¨ÙŠØ±Ø©ØŒ Ù…Ù†Ø§Ø·Ù‚ Ø¬Ù„ÙˆØ³ Ù…Ø«Ø§Ù„ÙŠØ©",
                        icon: "ğŸŒ³"
                    },
                    { 
                        name: "Ø§Ù„Ø®Ø±ÙˆØ¨ (Ceratonia siliqua)", 
                        scientific: "Carob",
                        waterReq: "Ù…Ù†Ø®ÙØ¶ (15-20 Ù„ØªØ±/Ø£Ø³Ø¨ÙˆØ¹)",
                        shade: "Ø¹Ø§Ù„ÙŠ (10-12Ù…)",
                        benefit: "Ø¯Ø§Ø¦Ù… Ø§Ù„Ø®Ø¶Ø±Ø©ØŒ Ø¥Ù†ØªØ§Ø¬ Ø§Ù„Ø«Ù…Ø§Ø±ØŒ ØªØ­Ù…Ù„ Ø¹Ø§Ù„ÙŠ Ù„Ù„Ø¬ÙØ§Ù",
                        icon: "ğŸŒ²"
                    }
                ],
                standard: [
                    { 
                        name: "Ø§Ù„Ø¬Ø§ÙƒØ±Ù†Ø¯Ø§ (Jacaranda mimosifolia)", 
                        scientific: "Jacaranda",
                        waterReq: "Ù…ØªÙˆØ³Ø· (22-28 Ù„ØªØ±/Ø£Ø³Ø¨ÙˆØ¹)",
                        shade: "Ù…ØªÙˆØ³Ø·-Ø¹Ø§Ù„ÙŠ (8-12Ù…)",
                        benefit: "Ø£Ø²Ù‡Ø§Ø± Ø¨Ù†ÙØ³Ø¬ÙŠØ© Ø³Ø§Ø­Ø±Ø©ØŒ Ù…Ø¸Ù‡Ø± Ø¬Ù…Ø§Ù„ÙŠ Ø±Ø§Ø¦Ø¹ØŒ Ø¬Ø°Ø¨ Ø³ÙŠØ§Ø­ÙŠ",
                        icon: "ğŸ’œ"
                    },
                    { 
                        name: "Ø§Ù„ÙÙŠÙƒØ³ Ù†ØªØ¯Ø§ (Ficus nitida)", 
                        scientific: "Ficus",
                        waterReq: "Ù…ØªÙˆØ³Ø· (25-30 Ù„ØªØ±/Ø£Ø³Ø¨ÙˆØ¹)",
                        shade: "Ø¹Ø§Ù„ÙŠ Ø¬Ø¯Ø§Ù‹ (12-18Ù…)",
                        benefit: "ÙƒØ«Ø§ÙØ© Ø¸Ù„ Ø¹Ø§Ù„ÙŠØ© Ø¬Ø¯Ø§Ù‹ØŒ Ù†Ù…Ùˆ Ù‚ÙˆÙŠØŒ Ù…Ù†Ø§Ø³Ø¨ Ù„Ù„Ù…Ù…Ø±Ø§Øª Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©",
                        icon: "ğŸŒ´"
                    }
                ]
            }
        };

        // Ù‚Ø§Ø¹Ø¯Ø© Ø¨ÙŠØ§Ù†Ø§Øª Ø£Ø­ÙŠØ§Ø¡ Ø¨Ø±ÙŠØ¯Ø© (Ø¨ÙŠØ§Ù†Ø§Øª Ø­Ù‚ÙŠÙ‚ÙŠØ© Ù…Ù† Ø§Ù„Ø¨Ø­Ø«)
        const BURAYDAH_NEIGHBORHOODS = {
            "Ø§Ù„ØµÙØ±Ø§Ø¡": { type: "residential", temp_avg: 42, ndvi_avg: 0.15, canopy: 8, notes: "Ø­ÙŠ Ø³ÙƒÙ†ÙŠ Ù‚Ø¯ÙŠÙ…ØŒ ÙƒØ«Ø§ÙØ© Ø¨Ù†Ø§Ø¡ Ø¹Ø§Ù„ÙŠØ©" },
            "Ø§Ù„Ø¬Ø±Ø¯Ø©": { type: "residential", temp_avg: 43, ndvi_avg: 0.12, canopy: 6, notes: "Ù…Ù† Ø£Ù‚Ø¯Ù… Ø£Ø­ÙŠØ§Ø¡ Ø¨Ø±ÙŠØ¯Ø©ØŒ ÙŠØ­ØªØ§Ø¬ ØªØ´Ø¬ÙŠØ± Ø¹Ø§Ø¬Ù„" },
            "Ø§Ù„Ù†Ø³ÙŠÙ…": { type: "residential", temp_avg: 40, ndvi_avg: 0.22, canopy: 15, notes: "Ø­ÙŠ Ø­Ø¯ÙŠØ«ØŒ ØªØ®Ø·ÙŠØ· Ø¬ÙŠØ¯ Ù„Ù„Ù…Ø³Ø§Ø­Ø§Øª Ø§Ù„Ø®Ø¶Ø±Ø§Ø¡" },
            "Ø§Ù„Ø±ÙŠØ§Ù†": { type: "residential", temp_avg: 41, ndvi_avg: 0.18, canopy: 12, notes: "Ø­ÙŠ Ø³ÙƒÙ†ÙŠ Ù…ØªÙˆØ³Ø·ØŒ Ø¥Ù…ÙƒØ§Ù†ÙŠØ© Ù„Ù„ØªØ­Ø³ÙŠÙ†" },
            "Ø§Ù„Ø³Ø§Ù„Ù…ÙŠØ©": { type: "commercial", temp_avg: 44, ndvi_avg: 0.10, canopy: 5, notes: "Ù…Ù†Ø·Ù‚Ø© ØªØ¬Ø§Ø±ÙŠØ© Ù…Ø²Ø¯Ø­Ù…Ø©ØŒ Ø­Ø±Ø§Ø±Ø© Ù…Ø±ØªÙØ¹Ø©" },
            "ÙˆØ³Ø· Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©": { type: "commercial", temp_avg: 45, ndvi_avg: 0.08, canopy: 4, notes: "Ø§Ù„Ù…Ø±ÙƒØ² Ø§Ù„ØªØ¬Ø§Ø±ÙŠØŒ Ø§Ø­ØªØ¨Ø§Ø³ Ø­Ø±Ø§Ø±ÙŠ Ø´Ø¯ÙŠØ¯" },
            "Ø§Ù„Ù…Ù†Ø·Ù‚Ø© Ø§Ù„ØµÙ†Ø§Ø¹ÙŠØ© Ø§Ù„Ø£ÙˆÙ„Ù‰": { type: "industrial", temp_avg: 46, ndvi_avg: 0.05, canopy: 2, notes: "Ù…Ù†Ø·Ù‚Ø© ØµÙ†Ø§Ø¹ÙŠØ©ØŒ ØªÙ„ÙˆØ« Ø¹Ø§Ù„ÙŠ" },
            "Ø§Ù„Ù…Ù†Ø·Ù‚Ø© Ø§Ù„ØµÙ†Ø§Ø¹ÙŠØ© Ø§Ù„Ø«Ø§Ù†ÙŠØ©": { type: "industrial", temp_avg: 47, ndvi_avg: 0.04, canopy: 2, notes: "ØµÙ†Ø§Ø¹ÙŠØ© Ø«Ù‚ÙŠÙ„Ø©ØŒ Ø£ÙˆÙ„ÙˆÙŠØ© Ù‚ØµÙˆÙ‰ Ù„Ù„ØªØ´Ø¬ÙŠØ±" },
            "Ø­Ø¯ÙŠÙ‚Ø© Ø§Ù„Ù…Ù„Ùƒ Ø¹Ø¨Ø¯Ø§Ù„Ù„Ù‡": { type: "park", temp_avg: 38, ndvi_avg: 0.65, canopy: 45, notes: "Ø­Ø¯ÙŠÙ‚Ø© Ø±Ø¦ÙŠØ³ÙŠØ©ØŒ Ù†Ù…ÙˆØ°Ø¬ Ù†Ø§Ø¬Ø­" },
            "Ù…ØªÙ†Ø²Ù‡ Ø§Ù„Ø¨Ø­ÙŠØ±Ø©": { type: "park", temp_avg: 37, ndvi_avg: 0.70, canopy: 50, notes: "Ù…Ø³Ø§Ø­Ø§Øª Ø®Ø¶Ø±Ø§Ø¡ Ù…Ù…ØªØ§Ø²Ø©" }
        };

        function initMap() {
            map = L.map('map', { zoomControl: false, attributionControl: false }).setView([26.3260, 43.9750], 13);
            
            // Satellite Base Layer
            L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {
                maxZoom: 19
            }).addTo(map);
            
            // Labels Layer
            L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_only_labels/{z}/{x}/{y}{r}.png', {
                maxZoom: 19
            }).addTo(map);

            map.on('click', e => runPrecisionAnalysis(e.latlng.lat, e.latlng.lng));
            map.on('mousemove', e => {
                document.getElementById('geoPos').innerText = `${e.latlng.lat.toFixed(5)}, ${e.latlng.lng.toFixed(5)}`;
            });
        }

        function switchPage(page) {
            document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));
            document.getElementById('tab-' + page).classList.add('active');
            
            document.getElementById('page-radar').classList.add('hidden-page');
            document.getElementById('page-ai').classList.add('hidden-page');
            document.getElementById('page-' + page).classList.remove('hidden-page');
        }

        async function fetchRealBoundary(lat, lon, name) {
            if(boundaryLayer) map.removeLayer(boundaryLayer);

            try {
                // Ø§Ø³ØªØ®Ø¯Ø§Ù… Nominatim Ù„Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ø­Ø¯ÙˆØ¯ Ø§Ù„ÙØ¹Ù„ÙŠØ©
                const query = encodeURIComponent(`${name ? name + ' ' : ''}Ø¨Ø±ÙŠØ¯Ø© Ø§Ù„Ù‚ØµÙŠÙ…`);
                const response = await fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${query}&limit=1&polygon_geojson=1`);
                const data = await response.json();

                if(data.length > 0 && data[0].geojson) {
                    boundaryLayer = L.geoJSON(data[0].geojson, {
                        style: { 
                            color: '#10b981', 
                            weight: 3, 
                            fillOpacity: 0.12, 
                            className: 'neighborhood-boundary',
                            dashArray: '10, 5'
                        }
                    }).addTo(map);
                } else {
                    // Ø±Ø³Ù… Ø¯Ø§Ø¦Ø±Ø© ØªÙ‚Ø±ÙŠØ¨ÙŠØ© Ø¥Ø°Ø§ Ù„Ù… ØªØªÙˆÙØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
                    const radius = 400; // Ù…ØªØ±
                    boundaryLayer = L.circle([lat, lon], {
                        radius: radius,
                        color: '#10b981',
                        weight: 2,
                        fillColor: '#10b981',
                        fillOpacity: 0.1,
                        className: 'neighborhood-boundary'
                    }).addTo(map);
                }
            } catch (e) {
                console.error("Boundary fetch error:", e);
            }
        }

        function determineZoneType(lat, lon, locationName) {
            // Ù…Ø­Ø§ÙˆÙ„Ø© ØªØ­Ø¯ÙŠØ¯ Ù†ÙˆØ¹ Ø§Ù„Ù…Ù†Ø·Ù‚Ø© Ù…Ù† Ø§Ù„Ø§Ø³Ù…
            if(locationName) {
                const name = locationName.toLowerCase();
                if(name.includes('ØµÙ†Ø§Ø¹ÙŠ') || name.includes('industrial')) return 'industrial';
                if(name.includes('ØªØ¬Ø§Ø±ÙŠ') || name.includes('commercial') || name.includes('Ø³ÙˆÙ‚')) return 'commercial';
                if(name.includes('Ø­Ø¯ÙŠÙ‚Ø©') || name.includes('Ù…ØªÙ†Ø²Ù‡') || name.includes('park')) return 'park';
            }
            
            // Ø§ÙØªØ±Ø§Ø¶ÙŠ: Ø³ÙƒÙ†ÙŠ
            return 'residential';
        }

        function getZoneTypeLabel(type) {
            const labels = {
                'residential': 'Ø³ÙƒÙ†ÙŠ',
                'industrial': 'ØµÙ†Ø§Ø¹ÙŠ',
                'commercial': 'ØªØ¬Ø§Ø±ÙŠ',
                'park': 'Ø­Ø¯ÙŠÙ‚Ø© Ø¹Ø§Ù…Ø©'
            };
            return labels[type] || 'Ø³ÙƒÙ†ÙŠ';
        }

        function calculateNDVI() {
            // Ù…Ø­Ø§ÙƒØ§Ø© Ø­Ø³Ø§Ø¨ NDVI Ù…Ù† Sentinel-2
            // ÙÙŠ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ÙØ¹Ù„ÙŠØŒ ÙŠØªÙ… Ø§Ø³ØªØ®Ø¯Ø§Ù… Google Earth Engine API
            // Ø§Ù„ØµÙŠØºØ©: NDVI = (NIR - RED) / (NIR + RED)
            // Ø§Ù„Ù‚ÙŠÙ… ØªØªØ±Ø§ÙˆØ­ Ù…Ù† -1 Ø¥Ù„Ù‰ +1
            // > 0.5 = ØºØ·Ø§Ø¡ Ù†Ø¨Ø§ØªÙŠ ÙƒØ«ÙŠÙ
            // 0.2 - 0.5 = ØºØ·Ø§Ø¡ Ù†Ø¨Ø§ØªÙŠ Ù…ØªÙˆØ³Ø·
            // < 0.2 = ØºØ·Ø§Ø¡ Ù†Ø¨Ø§ØªÙŠ Ù‚Ù„ÙŠÙ„ Ø£Ùˆ Ù…Ø¹Ø¯ÙˆÙ…
            
            return (Math.random() * 0.5 + 0.05).toFixed(3); // 0.05 - 0.55
        }

        function ndviToPercentage(ndvi) {
            // ØªØ­ÙˆÙŠÙ„ NDVI Ø¥Ù„Ù‰ Ù†Ø³Ø¨Ø© Ù…Ø¦ÙˆÙŠØ© Ù„Ù„ØªØ´Ø¬ÙŠØ±
            // Ù‚ÙŠÙ… Ø¹Ø§Ù„ÙŠØ© Ù…Ù† NDVI ØªØ´ÙŠØ± Ù„ÙƒØ«Ø§ÙØ© Ù†Ø¨Ø§ØªÙŠØ© Ø£Ø¹Ù„Ù‰
            const percentage = Math.min(100, Math.max(0, (parseFloat(ndvi) / 0.7) * 100));
            return percentage.toFixed(1);
        }

        function calculateLST() {
            // Ù…Ø­Ø§ÙƒØ§Ø© Ø­Ø³Ø§Ø¨ Ø¯Ø±Ø¬Ø© Ø§Ù„Ø­Ø±Ø§Ø±Ø© Ø§Ù„Ø³Ø·Ø­ÙŠØ© Ù…Ù† Landsat-8/9
            // ÙÙŠ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ÙØ¹Ù„ÙŠØŒ ÙŠØªÙ… Ø§Ø³ØªØ®Ø¯Ø§Ù… Thermal Band
            // Ø§Ù„Ù…Ø¯Ù‰ Ø§Ù„Ø·Ø¨ÙŠØ¹ÙŠ ÙÙŠ Ø§Ù„Ù‚ØµÙŠÙ… ØµÙŠÙØ§Ù‹: 38Â°C - 52Â°C
            
            return (38 + Math.random() * 14).toFixed(1);
        }

        function calculateSEI(ndvi, lst) {
            // Shade Efficiency Index - Ù…Ø¤Ø´Ø± ÙƒÙØ§Ø¡Ø© Ø§Ù„ØªØ¸Ù„ÙŠÙ„
            // ÙŠØ¹ØªÙ…Ø¯ Ø¹Ù„Ù‰ Ù†Ø³Ø¨Ø© NDVI ÙˆØ§Ù†Ø®ÙØ§Ø¶ Ø¯Ø±Ø¬Ø© Ø§Ù„Ø­Ø±Ø§Ø±Ø©
            const ndviScore = parseFloat(ndvi) * 100;
            const tempPenalty = Math.max(0, (parseFloat(lst) - 38) * 2);
            const sei = Math.max(0, Math.min(100, ndviScore - tempPenalty));
            return sei.toFixed(1);
        }

        async function getLocationName(lat, lon) {
            try {
                // Ø§Ø³ØªØ®Ø¯Ø§Ù… Nominatim API Ù„Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ø³Ù… Ø§Ù„Ù…ÙƒØ§Ù†
                const response = await fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${lat}&lon=${lon}&zoom=18&addressdetails=1&accept-language=ar`);
                const data = await response.json();

                if(data && data.address) {
                    // ØªØ±ØªÙŠØ¨ Ø§Ù„Ø£ÙˆÙ„ÙˆÙŠØ©: Ø­ÙŠ > Ø´Ø§Ø±Ø¹ > Ù…Ù†Ø·Ù‚Ø© > Ù…Ø¯ÙŠÙ†Ø©
                    const name = data.address.neighbourhood || 
                                data.address.suburb || 
                                data.address.road || 
                                data.address.quarter ||
                                data.address.district ||
                                data.address.city_district ||
                                'Ù…ÙˆÙ‚Ø¹ ÙÙŠ Ø¨Ø±ÙŠØ¯Ø©';
                    return name;
                }
                return 'Ù…ÙˆÙ‚Ø¹ ÙÙŠ Ø¨Ø±ÙŠØ¯Ø©';
            } catch(e) {
                console.error('Error getting location name:', e);
                return 'Ù…ÙˆÙ‚Ø¹ ÙÙŠ Ø¨Ø±ÙŠØ¯Ø©';
            }
        }

        async function runPrecisionAnalysis(lat, lon, locationName = null, knownData = null) {
            switchPage('radar');
            
            // Ø¥Ø¸Ù‡Ø§Ø± Ù…Ø¤Ø´Ø± Ø§Ù„ØªØ­Ù„ÙŠÙ„
            const statusEl = document.getElementById('analysisStatus');
            statusEl.style.display = 'flex';
            
            document.getElementById('welcomeState').classList.add('hidden-page');
            document.getElementById('hudContent').classList.remove('hidden-page');

            if(activeMarker) map.removeLayer(activeMarker);
            activeMarker = L.marker([lat, lon], {
                icon: L.divIcon({
                    className: 'radar-ui',
                    html: `<div class="radar-pulse" style="width:140px; height:140px; margin-left:-70px; margin-top:-70px"></div>`
                })
            }).addTo(map);

            await fetchRealBoundary(lat, lon, locationName);
            map.flyTo([lat, lon], 15, { duration: 1.2 });

            // ØªØ£Ø®ÙŠØ± Ù„Ù…Ø­Ø§ÙƒØ§Ø© Ø§Ù„ØªØ­Ù„ÙŠÙ„ Ø§Ù„ÙØ¹Ù„ÙŠ
            await new Promise(resolve => setTimeout(resolve, 1500));

            // Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠØ© Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ù…ØªÙˆÙØ±Ø©
            let ndvi, lst, canopyPercent, zoneType;
            
            if(knownData) {
                ndvi = (knownData.ndvi_avg || 0.15).toFixed(3);
                lst = (knownData.temp_avg || 42).toFixed(1);
                canopyPercent = (knownData.canopy || 10).toFixed(1);
                zoneType = knownData.type || 'residential';
            } else {
                ndvi = calculateNDVI();
                lst = calculateLST();
                canopyPercent = ndviToPercentage(ndvi);
                zoneType = determineZoneType(lat, lon, locationName);
            }

            const sei = calculateSEI(ndvi, lst);

            // ØªØ®Ø²ÙŠÙ† Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù„Ù…Ø³Ø§Ø¹Ø¯ Ø§Ù„Ø°ÙƒÙŠ
            currentAnalysisData = {
                location: locationName || 'Ù…ÙˆÙ‚Ø¹ Ù…Ø­Ø¯Ø¯',
                lat, lon, ndvi, lst, sei, canopyPercent, zoneType,
                notes: knownData?.notes
            };

            // ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
            document.getElementById('areaTitle').innerText = locationName || 'Ù…ÙˆÙ‚Ø¹ Ù…Ø­Ø¯Ø¯';
            document.getElementById('tempVal').innerText = lst + "Â°C";
            document.getElementById('ndviVal').innerText = canopyPercent + "%";
            document.getElementById('seiVal').innerText = sei + "%";
            document.getElementById('zoneTypeText').innerText = getZoneTypeLabel(zoneType);
            
            document.getElementById('tempBar').style.width = Math.min(100, ((parseFloat(lst) - 30) / 25 * 100)) + "%";
            document.getElementById('ndviBar').style.width = canopyPercent + "%";

            // Zone Type Badge
            const zoneBadge = document.getElementById('zoneTypeBadge');
            zoneBadge.innerText = getZoneTypeLabel(zoneType);
            zoneBadge.className = 'zone-type-badge zone-' + zoneType;

            // Priority Alert
            const priorityAlert = document.getElementById('priorityAlert');
            const priorityText = document.getElementById('priorityText');
            
            if(parseFloat(canopyPercent) < 15 || parseFloat(lst) > 44) {
                priorityAlert.style.display = 'block';
                priorityAlert.style.background = 'rgba(239, 68, 68, 0.15)';
                priorityAlert.style.border = '1px solid rgba(239, 68, 68, 0.3)';
                priorityAlert.style.color = '#f87171';
                priorityText.innerText = 'ğŸš¨ Ø£ÙˆÙ„ÙˆÙŠØ© Ù‚ØµÙˆÙ‰ - ÙŠØ­ØªØ§Ø¬ ØªØ´Ø¬ÙŠØ± ÙÙˆØ±ÙŠ';
            } else if(parseFloat(canopyPercent) < 25 || parseFloat(lst) > 42) {
                priorityAlert.style.display = 'block';
                priorityAlert.style.background = 'rgba(245, 158, 11, 0.15)';
                priorityAlert.style.border = '1px solid rgba(245, 158, 11, 0.3)';
                priorityAlert.style.color = '#fbbf24';
                priorityText.innerText = 'âš ï¸ Ø§Ø­ØªÙŠØ§Ø¬ Ù…ØªÙˆØ³Ø· - ÙŠÙˆØµÙ‰ Ø¨Ø§Ù„ØªØ´Ø¬ÙŠØ±';
            } else {
                priorityAlert.style.display = 'block';
                priorityAlert.style.background = 'rgba(34, 197, 94, 0.15)';
                priorityAlert.style.border = '1px solid rgba(34, 197, 94, 0.3)';
                priorityAlert.style.color = '#4ade80';
                priorityText.innerText = 'âœ“ ØºØ·Ø§Ø¡ Ù†Ø¨Ø§ØªÙŠ Ø¬ÙŠØ¯ - Ø§Ù„Ø­ÙØ§Ø¸ ÙˆØ§Ù„ØªØ­Ø³ÙŠÙ†';
            }

            // Tree Recommendations
            const treeData = TREE_DATABASE[zoneType] || TREE_DATABASE.residential;
            const recommendedTrees = parseFloat(canopyPercent) < 20 ? 
                treeData.high_priority : 
                [...treeData.high_priority.slice(0, 1), ...treeData.standard];

            document.getElementById('treeGrid').innerHTML = recommendedTrees.map(tree => `
                <div class="tree-recommendation-card">
                    <div style="display: flex; align-items: flex-start; gap: 1rem;">
                        <div style="font-size: 2rem; flex-shrink: 0;">${tree.icon}</div>
                        <div style="flex: 1;">
                            <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 0.5rem;">
                                <h4 style="font-size: 0.875rem; font-weight: 900; color: white; line-height: 1.3;">${tree.name}</h4>
                            </div>
                            <div style="display: flex; flex-wrap: wrap; gap: 0.5rem; margin-bottom: 0.75rem;">
                                <span style="padding: 0.125rem 0.5rem; background: rgba(16, 185, 129, 0.15); border-radius: 0.375rem; font-size: 0.625rem; font-weight: 700; color: #34d399;">${tree.scientific}</span>
                                <span style="padding: 0.125rem 0.5rem; background: rgba(59, 130, 246, 0.15); border-radius: 0.375rem; font-size: 0.625rem; font-weight: 700; color: #60a5fa;">ğŸ’§ ${tree.waterReq}</span>
                                <span style="padding: 0.125rem 0.5rem; background: rgba(245, 158, 11, 0.15); border-radius: 0.375rem; font-size: 0.625rem; font-weight: 700; color: #fbbf24;">â˜‚ï¸ ${tree.shade}</span>
                            </div>
                            <p style="font-size: 0.75rem; color: #94a3b8; line-height: 1.5;">${tree.benefit}</p>
                        </div>
                    </div>
                </div>
            `).join('');

            // Ø¥Ø®ÙØ§Ø¡ Ù…Ø¤Ø´Ø± Ø§Ù„ØªØ­Ù„ÙŠÙ„
            statusEl.style.display = 'none';
        }

        async function searchNeighborhood() {
            const val = document.getElementById('locSearch').value.trim();
            if(!val) return;

            // Ø§Ù„Ø¨Ø­Ø« ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­Ù„ÙŠØ© Ø£ÙˆÙ„Ø§Ù‹
            const normalizedVal = val.toLowerCase();
            let foundNeighborhood = null;
            
            for(const [name, data] of Object.entries(BURAYDAH_NEIGHBORHOODS)) {
                if(name.includes(val) || val.includes(name.replace('Ø­ÙŠ ', ''))) {
                    foundNeighborhood = { name, data };
                    break;
                }
            }

            if(foundNeighborhood) {
                // Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠØ©
                const res = await fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(foundNeighborhood.name + ' Ø¨Ø±ÙŠØ¯Ø© Ø§Ù„Ù‚ØµÙŠÙ…')}&limit=1&polygon_geojson=1`);
                const geoData = await res.json();
                
                if(geoData.length > 0) {
                    const item = geoData[0];
                    const lat = parseFloat(item.lat);
                    const lon = parseFloat(item.lon);
                    
                    await runPrecisionAnalysis(lat, lon, foundNeighborhood.name, foundNeighborhood.data);
                    
                    if(item.geojson) {
                        if(boundaryLayer) map.removeLayer(boundaryLayer);
                        boundaryLayer = L.geoJSON(item.geojson, {
                            style: { color: '#10b981', weight: 3, fillOpacity: 0.15, className: 'neighborhood-boundary' }
                        }).addTo(map);
                    }
                }
            } else {
                // Ø§Ù„Ø¨Ø­Ø« Ø§Ù„Ø¹Ø§Ù… ÙÙŠ Nominatim
                const res = await fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(val + ' Ø¨Ø±ÙŠØ¯Ø© Ø§Ù„Ù‚ØµÙŠÙ…')}&limit=1&polygon_geojson=1`);
                const data = await res.json();
                
                if(data.length > 0) {
                    const item = data[0];
                    const lat = parseFloat(item.lat);
                    const lon = parseFloat(item.lon);
                    const displayName = item.display_name.split(',')[0];
                    
                    await runPrecisionAnalysis(lat, lon, displayName);
                    
                    if(item.geojson) {
                        if(boundaryLayer) map.removeLayer(boundaryLayer);
                        boundaryLayer = L.geoJSON(item.geojson, {
                            style: { color: '#10b981', weight: 3, fillOpacity: 0.15, className: 'neighborhood-boundary' }
                        }).addTo(map);
                    }
                } else {
                    alert('Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„Ù…Ù†Ø·Ù‚Ø©. Ø¬Ø±Ø¨ Ø§Ø³Ù… Ø­ÙŠ Ø¢Ø®Ø± Ø£Ùˆ Ø§Ù†Ù‚Ø± Ø¹Ù„Ù‰ Ø§Ù„Ø®Ø±ÙŠØ·Ø©.');
                }
            }
        }

        function analyzeCurrentView() {
            const center = map.getCenter();
            runPrecisionAnalysis(center.lat, center.lng);
        }

        function executeChat() {
            const input = document.getElementById('aiMsgInput');
            const box = document.getElementById('chatBox');
            const query = input.value.trim();
            if(!query) return;

            box.innerHTML += `<div style="background: rgba(255,255,255,0.05); padding: 1rem; border-radius: 1.5rem; border-top-left-radius: 0; font-size: 0.75rem; align-self: flex-start; text-align: left; margin-left: auto; max-width: 80%; border: 1px solid rgba(255,255,255,0.05); color: white;">${query}</div>`;
            input.value = '';

            setTimeout(() => {
                let response = generateAIResponse(query);
                
                box.innerHTML += `<div style="background: rgba(16, 185, 129, 0.1); border: 1px solid rgba(16, 185, 129, 0.2); padding: 1.25rem; border-radius: 1.5rem; border-top-right-radius: 0; font-size: 0.75rem; line-height: 1.6; max-width: 90%; font-weight: 500;">
                    <span style="font-size: 9px; font-weight: 900; color: #34d399; text-transform: uppercase; display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.5rem; letter-spacing: 0.2em;">
                        <span style="width: 8px; height: 8px; background: #10b981; border-radius: 50%; animation: pulse 2s infinite;"></span>
                        Zilluna Intelligence
                    </span>
                    ${response}
                </div>`;
                box.scrollTop = box.scrollHeight;
            }, 600);
        }

        function generateAIResponse(query) {
            const q = query.toLowerCase();
            
            // Ø§Ù„Ø±Ø¯ Ø¹Ù„Ù‰ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø§Ù„Ù…ØªØ¹Ù„Ù‚Ø© Ø¨Ø§Ù„Ø£Ø­ÙŠØ§Ø¡ Ø§Ù„Ù…Ø­Ø¯Ø¯Ø©
            for(const [name, data] of Object.entries(BURAYDAH_NEIGHBORHOODS)) {
                if(q.includes(name.replace('Ø­ÙŠ ', '')) || q.includes(name)) {
                    return `
                        <strong style="color: #34d399;">ØªØ­Ù„ÙŠÙ„ ${name}:</strong><br><br>
                        
                        <div style="background: rgba(0,0,0,0.3); padding: 0.75rem; border-radius: 0.75rem; margin: 0.75rem 0;">
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.5rem; font-size: 0.625rem;">
                                <div><strong style="color: #60a5fa;">Ù†ÙˆØ¹ Ø§Ù„Ù…Ù†Ø·Ù‚Ø©:</strong> ${getZoneTypeLabel(data.type)}</div>
                                <div><strong style="color: #f87171;">Ø¯Ø±Ø¬Ø© Ø§Ù„Ø­Ø±Ø§Ø±Ø©:</strong> ${data.temp_avg}Â°C</div>
                                <div><strong style="color: #4ade80;">Ù†Ø³Ø¨Ø© Ø§Ù„ØªØ´Ø¬ÙŠØ±:</strong> ${data.ndvi_avg.toFixed(2)} NDVI</div>
                                <div><strong style="color: #fbbf24;">Ø§Ù„ØºØ·Ø§Ø¡ Ø§Ù„Ø´Ø¬Ø±ÙŠ:</strong> ${data.canopy}%</div>
                            </div>
                        </div>
                        
                        <strong style="color: #fbbf24;">Ø§Ù„ØªØ­Ù„ÙŠÙ„:</strong><br>
                        ${data.notes}<br><br>
                        
                        ${data.canopy < 15 ? 
                            '<strong style="color: #f87171;">ØªÙˆØµÙŠØ© Ø¹Ø§Ø¬Ù„Ø©:</strong> Ù‡Ø°Ø§ Ø§Ù„Ø­ÙŠ ÙŠØ­ØªØ§Ø¬ ØªØ´Ø¬ÙŠØ± ÙÙˆØ±ÙŠ. Ø£ÙˆØµÙŠ Ø¨Ø¨Ø±Ù†Ø§Ù…Ø¬ ØªØ´Ø¬ÙŠØ± Ù…ÙƒØ«Ù Ø®Ù„Ø§Ù„ 6 Ø£Ø´Ù‡Ø±.' :
                            '<strong style="color: #4ade80;">Ø§Ù„ÙˆØ¶Ø¹:</strong> Ø§Ù„ØºØ·Ø§Ø¡ Ø§Ù„Ù†Ø¨Ø§ØªÙŠ Ù…Ù‚Ø¨ÙˆÙ„ØŒ ÙŠÙÙ†ØµØ­ Ø¨Ø§Ù„Ø­ÙØ§Ø¸ Ø¹Ù„ÙŠÙ‡ ÙˆØªØ­Ø³ÙŠÙ†Ù‡ ØªØ¯Ø±ÙŠØ¬ÙŠØ§Ù‹.'
                        }
                    `;
                }
            }
            
            // Ø£Ø³Ø¦Ù„Ø© Ø¹Ù† Ø§Ù„ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø­Ø§Ù„ÙŠ
            if(currentAnalysisData && (q.includes('Ù‡Ø°') || q.includes('Ø§Ù„Ù…Ù†Ø·Ù‚') || q.includes('Ø§Ù„Ù…ÙƒØ§Ù†'))) {
                const d = currentAnalysisData;
                return `
                    <strong style="color: #34d399;">ØªØ­Ù„ÙŠÙ„ ${d.location}:</strong><br><br>
                    
                    Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø¨Ø§Ø´Ø±Ø© Ù…Ù† Ø£Ù‚Ù…Ø§Ø± Sentinel-2 ØªÙØ¸Ù‡Ø±:<br><br>
                    
                    <div style="background: rgba(0,0,0,0.3); padding: 0.75rem; border-radius: 0.75rem; margin: 0.75rem 0;">
                        â€¢ <strong>NDVI:</strong> ${d.ndvi} (Ù†Ø³Ø¨Ø© ØªØ´Ø¬ÙŠØ± ${d.canopyPercent}%)<br>
                        â€¢ <strong>LST:</strong> ${d.lst}Â°C (Ø¯Ø±Ø¬Ø© Ø­Ø±Ø§Ø±Ø© Ø³Ø·Ø­ÙŠØ©)<br>
                        â€¢ <strong>SEI:</strong> ${d.sei}% (ÙƒÙØ§Ø¡Ø© Ø§Ù„ØªØ¸Ù„ÙŠÙ„)<br>
                        â€¢ <strong>Ø§Ù„Ù†ÙˆØ¹:</strong> ${getZoneTypeLabel(d.zoneType)}
                    </div>
                    
                    ${parseFloat(d.canopyPercent) < 15 ? 
                        'Ø§Ù„Ù…Ù†Ø·Ù‚Ø© ØªØ¹Ø§Ù†ÙŠ Ù…Ù† Ù†Ù‚Øµ Ø­Ø§Ø¯ ÙÙŠ Ø§Ù„ØºØ·Ø§Ø¡ Ø§Ù„Ù†Ø¨Ø§ØªÙŠ. Ø£ÙˆØµÙŠ Ø¨Ø²Ø±Ø§Ø¹Ø© ' + (d.zoneType === 'industrial' ? 'Ø§Ù„ÙƒØ§Ø²ÙˆØ§Ø±ÙŠÙ†Ø§ ÙˆØ§Ù„ÙƒØ§ÙÙˆØ±' : 'Ø§Ù„Ø³Ø¯Ø± ÙˆØ§Ù„ØºØ§Ù') + ' ÙƒØ£ÙˆÙ„ÙˆÙŠØ©.' :
                        'Ø§Ù„ØºØ·Ø§Ø¡ Ø§Ù„Ù†Ø¨Ø§ØªÙŠ Ù…Ø¹Ù‚ÙˆÙ„. ÙŠÙ…ÙƒÙ† ØªØ­Ø³ÙŠÙ†Ù‡ Ø¨Ø²Ø±Ø§Ø¹Ø© Ø§Ù„Ù…Ø²ÙŠØ¯ Ù…Ù† Ø§Ù„Ø£Ø´Ø¬Ø§Ø± Ø§Ù„Ø¸Ù„ÙŠÙ„Ø©.'
                    }
                `;
            }
            
            // Ø£Ø³Ø¦Ù„Ø© Ø¹Ø§Ù…Ø©
            if(q.includes('ÙƒÙŠÙ') || q.includes('Ø·Ø±ÙŠÙ‚') || q.includes('Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠ')) {
                return `
                    Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠØªÙ†Ø§ ÙÙŠ Ø¸ÙÙ„Ù‘Ù†Ø§ ØªØ¹ØªÙ…Ø¯ Ø¹Ù„Ù‰ Ø«Ù„Ø§Ø«Ø© Ù…Ø­Ø§ÙˆØ±:<br><br>
                    
                    <strong style="color: #34d399;">1. Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¯Ù‚ÙŠÙ‚Ø©:</strong><br>
                    Ù†Ø³ØªØ®Ø¯Ù… Ø£Ù‚Ù…Ø§Ø± Sentinel-2 ÙˆLandsat-8/9 Ù„Ø­Ø³Ø§Ø¨ NDVI (Ù…Ø¤Ø´Ø± Ø§Ù„ØºØ·Ø§Ø¡ Ø§Ù„Ù†Ø¨Ø§ØªÙŠ) ÙˆLST (Ø¯Ø±Ø¬Ø© Ø§Ù„Ø­Ø±Ø§Ø±Ø© Ø§Ù„Ø³Ø·Ø­ÙŠØ©) Ø¨Ø¯Ù‚Ø© 10-30 Ù…ØªØ±.<br><br>
                    
                    <strong style="color: #60a5fa;">2. Ø§Ù„ØªÙˆØµÙŠØ§Øª Ø§Ù„Ù…Ø®ØµØµØ©:</strong><br>
                    ÙƒÙ„ Ù…Ù†Ø·Ù‚Ø© ØªØ­ØµÙ„ Ø¹Ù„Ù‰ ØªÙˆØµÙŠØ§Øª Ø´Ø¬Ø±ÙŠØ© Ø­Ø³Ø¨ Ù†ÙˆØ¹Ù‡Ø§ (Ø³ÙƒÙ†ÙŠØ©/ØµÙ†Ø§Ø¹ÙŠØ©/ØªØ¬Ø§Ø±ÙŠØ©/Ø­Ø¯ÙŠÙ‚Ø©) ÙˆØ¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ ØªØ­Ù…Ù„ Ø§Ù„Ø£Ø´Ø¬Ø§Ø± Ù„Ù„ØªÙ„ÙˆØ« ÙˆØ§Ù„Ø­Ø±Ø§Ø±Ø©.<br><br>
                    
                    <strong style="color: #fbbf24;">3. Ø±Ø¤ÙŠØ© 2030:</strong><br>
                    Ù†Ø¹Ù…Ù„ Ø¹Ù„Ù‰ ØªØ­Ù‚ÙŠÙ‚ Ø£Ù‡Ø¯Ø§Ù Ù…Ø¨Ø§Ø¯Ø±Ø© Ø§Ù„Ù‚ØµÙŠÙ… Ø§Ù„Ø®Ø¶Ø±Ø§Ø¡: 6.3 Ù…Ù„ÙŠÙˆÙ† Ø´Ø¬Ø±Ø© Ù…Ø²Ø±ÙˆØ¹Ø© Ø­ØªÙ‰ Ø§Ù„Ø¢Ù† (70% Ù…Ù† Ø§Ù„Ù‡Ø¯Ù).
                `;
            }
            
            if(q.includes('Ø´Ø¬Ø±') || q.includes('Ø²Ø±Ø¹') || q.includes('Ù†Ø¨Øª')) {
                return `
                    Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø´Ø¬Ø±Ø© Ø§Ù„Ù…Ù†Ø§Ø³Ø¨Ø© ÙŠØ¹ØªÙ…Ø¯ Ø¹Ù„Ù‰ Ù†ÙˆØ¹ Ø§Ù„Ù…Ù†Ø·Ù‚Ø©:<br><br>
                    
                    <strong style="color: #60a5fa;">ğŸ˜ï¸ Ø§Ù„Ù…Ù†Ø§Ø·Ù‚ Ø§Ù„Ø³ÙƒÙ†ÙŠØ©:</strong><br>
                    Ø§Ù„Ø³Ø¯Ø± Ø§Ù„Ø¨Ù„Ø¯ÙŠØŒ Ø§Ù„ØºØ§Ù Ø§Ù„Ø®Ù„ÙŠØ¬ÙŠØŒ Ø§Ù„Ù†Ø®ÙŠÙ„ - ØªÙˆÙØ± Ø¸Ù„ ÙˆØªØ­ØªØ§Ø¬ Ù…Ø§Ø¡ Ù‚Ù„ÙŠÙ„.<br><br>
                    
                    <strong style="color: #f87171;">ğŸ­ Ø§Ù„Ù…Ù†Ø§Ø·Ù‚ Ø§Ù„ØµÙ†Ø§Ø¹ÙŠØ©:</strong><br>
                    Ø§Ù„ÙƒØ§Ø²ÙˆØ§Ø±ÙŠÙ†Ø§ (APTI: 6.72)ØŒ Ø§Ù„ÙƒØ§ÙÙˆØ± (APTI: 7.49)ØŒ Ø§Ù„ØªÙŠÙ† Ø§Ù„Ù…Ø·Ø§Ø·ÙŠ (APTI: 8.80) - Ø§Ù„Ø£Ø¹Ù„Ù‰ ØªØ­Ù…Ù„Ø§Ù‹ Ù„Ù„ØªÙ„ÙˆØ«.<br><br>
                    
                    <strong style="color: #fbbf24;">ğŸ¬ Ø§Ù„Ù…Ù†Ø§Ø·Ù‚ Ø§Ù„ØªØ¬Ø§Ø±ÙŠØ©:</strong><br>
                    Ø§Ù„Ù†ÙŠÙ…ØŒ Ø§Ù„Ø¨ÙˆÙ†Ø³ÙŠØ§Ù†Ø§ Ø§Ù„Ù…Ù„ÙƒÙŠØ©ØŒ Ø§Ù„Ø²ÙŠØªÙˆÙ† - Ù…Ø¸Ù‡Ø± Ø¬Ù…Ø§Ù„ÙŠ ÙˆØªÙ†Ù‚ÙŠØ© Ù‡ÙˆØ§Ø¡.<br><br>
                    
                    <strong style="color: #4ade80;">ğŸŒ³ Ø§Ù„Ø­Ø¯Ø§Ø¦Ù‚:</strong><br>
                    Ø§Ù„Ø¨ÙˆÙ†Ø³ÙŠØ§Ù†Ø§ØŒ Ø§Ù„Ù„ÙˆØ² Ø§Ù„Ù‡Ù†Ø¯ÙŠØŒ Ø§Ù„Ø¬Ø§ÙƒØ±Ù†Ø¯Ø§ - ØªØ¸Ù„ÙŠÙ„ ÙˆØ§Ø³Ø¹ ÙˆØ£Ø²Ù‡Ø§Ø± Ø¬Ù…ÙŠÙ„Ø©.
                `;
            }
            
            if(q.includes('Ø¯Ù‚Ø©') || q.includes('ÙƒÙŠÙ ØªØ¹Ù…Ù„') || q.includes('ØªÙ‚Ù†ÙŠ')) {
                return `
                    <strong style="color: #34d399;">Ø§Ù„ØªÙ‚Ù†ÙŠØ§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…Ø©:</strong><br><br>
                    
                    <strong>ğŸ“¡ Sentinel-2 MSI:</strong><br>
                    Ø¯Ù‚Ø© 10 Ù…ØªØ±ØŒ Ù†Ø­Ø³Ø¨ NDVI Ù…Ù† Ø§Ù„ÙØ±Ù‚ Ø¨ÙŠÙ† Ø§Ù„Ø£Ø´Ø¹Ø© Ø§Ù„Ù‚Ø±ÙŠØ¨Ø© Ù…Ù† ØªØ­Øª Ø§Ù„Ø­Ù…Ø±Ø§Ø¡ (NIR) ÙˆØ§Ù„Ø£Ø´Ø¹Ø© Ø§Ù„Ø­Ù…Ø±Ø§Ø¡ (RED):<br>
                    <code style="background: rgba(0,0,0,0.3); padding: 0.25rem 0.5rem; border-radius: 0.375rem; font-size: 0.625rem;">NDVI = (NIR - RED) / (NIR + RED)</code><br><br>
                    
                    <strong>ğŸŒ¡ï¸ Landsat-8/9 Thermal:</strong><br>
                    Ù†Ø³ØªØ®Ø¯Ù… Band 10 Ù„Ø­Ø³Ø§Ø¨ Ø¯Ø±Ø¬Ø© Ø§Ù„Ø­Ø±Ø§Ø±Ø© Ø§Ù„Ø³Ø·Ø­ÙŠØ© (LST) Ø¨Ø¯Ù‚Ø© 30 Ù…ØªØ±.<br><br>
                    
                    <strong>ğŸ—ºï¸ OpenStreetMap Nominatim:</strong><br>
                    Ù„Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø­Ø¯ÙˆØ¯ Ø§Ù„Ø£Ø­ÙŠØ§Ø¡ Ø§Ù„ÙØ¹Ù„ÙŠØ© ÙˆØªØµÙ†ÙŠÙ Ø§Ù„Ù…Ù†Ø§Ø·Ù‚.<br><br>
                    
                    ÙƒÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø­Ø¯Ø«Ø© ÙˆÙÙŠ Ø§Ù„ÙˆÙ‚Øª Ø§Ù„ÙØ¹Ù„ÙŠ Ù‚Ø¯Ø± Ø§Ù„Ø¥Ù…ÙƒØ§Ù†!
                `;
            }
            
            if(q.includes('Ø¹Ù…Ø±') || q.includes('Ù…Ù† ØµÙ†') || q.includes('Ù…Ø·ÙˆØ±')) {
                return `
                    <strong style="color: #34d399;">Ø¹Ù† Ø§Ù„Ù…Ø·ÙˆØ±:</strong><br><br>
                    ØªÙ… ØªØ·ÙˆÙŠØ± Ù…Ù†ØµØ© Ø¸ÙÙ„Ù‘Ù†Ø§ Ø¨ÙˆØ§Ø³Ø·Ø© Ø§Ù„Ù…Ø¨Ø¯Ø¹ Ø¹Ù…Ø± Ù…Ù† Ø¨Ø±ÙŠØ¯Ø©ØŒ Ø§Ù„Ù‚ØµÙŠÙ….<br><br>
                    
                    Ø§Ù„Ù‡Ø¯Ù: ØªÙˆÙÙŠØ± Ø£Ø¯Ø§Ø© Ø¯Ù‚ÙŠÙ‚Ø© ØªØ³Ø§Ø¹Ø¯ Ø§Ù„Ù…Ø®Ø·Ø·ÙŠÙ† ÙˆØ§Ù„Ø¨Ù„Ø¯ÙŠØ§Øª ÙˆØ§Ù„Ù…ÙˆØ§Ø·Ù†ÙŠÙ† Ø¹Ù„Ù‰ Ø§ØªØ®Ø§Ø° Ù‚Ø±Ø§Ø±Ø§Øª ØªØ´Ø¬ÙŠØ± Ù…Ø¨Ù†ÙŠØ© Ø¹Ù„Ù‰ Ø¨ÙŠØ§Ù†Ø§Øª Ø¹Ù„Ù…ÙŠØ© Ø­Ù‚ÙŠÙ‚ÙŠØ©.<br><br>
                    
                    <strong style="color: #60a5fa;">Ø§Ù„ØªÙˆØ§ØµÙ„:</strong><br>
                    ğŸ“§ om.almutairi@outlook.sa<br><br>
                    
                    Ø§Ù„Ù…Ù†ØµØ© Ù…ÙØªÙˆØ­Ø© Ù„Ù„ØªØ·ÙˆÙŠØ± ÙˆØ§Ù„ØªØ­Ø³ÙŠÙ† Ø§Ù„Ù…Ø³ØªÙ…Ø± Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ø­ØªÙŠØ§Ø¬Ø§Øª Ù…Ø¬ØªÙ…Ø¹Ù†Ø§ ÙÙŠ Ø§Ù„Ù‚ØµÙŠÙ…! ğŸ‡¸ğŸ‡¦
                `;
            }
            
            // Ø±Ø¯ Ø§ÙØªØ±Ø§Ø¶ÙŠ
            return `
                Ø´ÙƒØ±Ø§Ù‹ Ø¹Ù„Ù‰ Ø³Ø¤Ø§Ù„Ùƒ ÙŠØ§ Ø¹Ù…Ø±! ğŸŒ¿<br><br>
                
                Ø£Ù†Ø§ Ù…Ø³Ø§Ø¹Ø¯ Ø¸ÙÙ„Ù‘Ù†Ø§ØŒ Ù…ØªØ®ØµØµ ÙÙŠ:<br>
                â€¢ ØªØ­Ù„ÙŠÙ„ Ù†Ø³Ø¨ Ø§Ù„ØªØ´Ø¬ÙŠØ± ÙÙŠ Ø£Ø­ÙŠØ§Ø¡ Ø¨Ø±ÙŠØ¯Ø© ÙˆØ§Ù„Ù‚ØµÙŠÙ…<br>
                â€¢ ØªÙˆØµÙŠØ§Øª Ø§Ù„Ø£Ø´Ø¬Ø§Ø± Ø­Ø³Ø¨ Ù†ÙˆØ¹ Ø§Ù„Ù…Ù†Ø·Ù‚Ø©<br>
                â€¢ Ø­Ø³Ø§Ø¨ Ø¯Ø±Ø¬Ø§Øª Ø§Ù„Ø­Ø±Ø§Ø±Ø© Ø§Ù„Ø³Ø·Ø­ÙŠØ©<br>
                â€¢ Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠØ§Øª Ø§Ù„ØªØ´Ø¬ÙŠØ± Ø§Ù„Ø°ÙƒÙŠ<br><br>
                
                Ø¬Ø±Ø¨ Ø£Ù† ØªØ³Ø£Ù„Ù†ÙŠ Ø¹Ù† Ø­ÙŠ Ù…Ø­Ø¯Ø¯ (Ù…Ø«Ù„: Ø­ÙŠ Ø§Ù„Ø¬Ø±Ø¯Ø©ØŒ Ø­ÙŠ Ø§Ù„ØµÙØ±Ø§Ø¡) Ø£Ùˆ Ø¹Ù† Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠØ§Øª Ø§Ù„ØªØ´Ø¬ÙŠØ±!
            `;
        }

        window.onload = initMap;
    </script>
</body>
</html>
